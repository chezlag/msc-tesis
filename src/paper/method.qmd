# Estrategia empírica {#sec-method}

Analizo el impacto de la recepción de facturas electrónicas sobre distintos desempeños de las empresas desde un enfoque de diferencias en diferencias. En mi análisis principal estimo una especificación con efectos fijos bidireccionales de la forma:

$$
y_{it} = \alpha_{i} + \tau_{t} + \beta_{post}\ D_{it} + u_{it}
$${#eq-twfe}

donde $y_{it}$ es el resultado de la empresa $i$ en el año $t$, $\alpha_{i}$ y $\tau_{t}$ son efectos fijos de empresa y año, y $D_{it}$ es un indicador que toma valor uno si la empresa $i$ recibió una e-factura en el período $t$. El impacto total de la política viene dado por el coeficiente $\beta_{post}$, que representa el efecto promedio de recibir e-facturas experimentado por todas las empresas que en algún momento recibieron una.

Comparo la variación en los resultados de las empresas que reciben facturas electrónicas (tratadas) con la variación en los resultados de las empresas que aún no han recibido (controles). El supuesto de identificación central es que las empresas tratadas y el grupo de control habrían evolucionado en paralelo en ausencia de facturación electrónica.

Para aportar evidencia que apoye el supuesto de tendencias paralelas, estimo una especificación de estudio de eventos de la @eq-twfe:

$$
y_{it} = \alpha_{i} + \tau_{t}+ \sum_{l\neq -1, l = -7}^{l = 3} \beta_{l}\cdot \mathbb{1}(R_{it} = l) + u_{it}
$${#eq-es}

donde $R_{it}$ indica los años desde el momento en que las empresas reciben su primera e-factura. Los coeficientes $\beta_{l}$ capturan la diferencia de resultados entre empresas tratadas y controles a $l$ períodos de recibir el tratamiento.

Mis variables de resultado son IVA compras, IVA ventas y el IVA adeudado neto (= máx{IVA ventas - IVA compras, 0}). Para la forma funcional sigo las recomendaciones de @chenLogsZerosProblems2023 para lidiar con variables dependientes en logaritmos cuando hay un porcentaje no trivial de ceros en su distribución. Una de sus propuestas –la que sigo– implica reescalar la variable de resultado $Y_{it}$ respecto a su valor mínimo $Y_{min}$ y asignarle un valor específico $\varepsilon$ a los cambios en el margen extensivo. Formalmente, defino 

$$
y_{it} =
\begin{cases}
  \log(\frac{Y_{it}}{Y_{min}}) & \text{si } Y_{it}>0 \\
  -\varepsilon                 & \text{si } Y_{it} = 0
\end{cases}
$$

En mi especificación preferida asumo que los cambios en el margen extensivo (de cero a $Y_{min}$) son equivalentes a un cambio de 10% en el margen intensivo –es decir, $\varepsilon=0.10$–. Como ejercicio de robustez, varío el valor asignado a $\varepsilon$ para ver que los resultados se mantienen independientemente de cuanto peso otorgo a los cambios en el margen extensivo. Por otra parte, aplico una censura superior (*winsorizing*) de los resultados en el percentil 99 de cada año. [^winsorizing]

[^winsorizing]: La censura superior de las variables de resultado elimina la influencia de outliers y de errores en el ingreso de los datos. Aún en ausencia de errores, censurar los datos puede ser óptimo al estimar medias en muestras finitas de distribuciones asimétricas [@rivestStatisticalPropertiesWinsorized1994]. Como ejercicio de robustez, replico las estimaciones censurando en el percentil 95 de cada año.

Testeo las hipótesis planteadas en la @sec-hypotheses con los coeficientes $\beta_{post}$ de la @eq-twfe. Es decir, me centro en el efecto agregado de la política para testear si la recepción de e-facturas tuvo un efecto sobre el cumplimiento tributario de las empresas. Para testear la existencia de efectos heterogéneos realizo las estimaciones en subgrupos de la muestra y comparo los $\beta_{post}$ de cada subgrupo. Para ver heterogeneidades por tamaño realizo las estimaciones en empresas con activos pre-tratamiento por encima y por debajo de la mediana. Por otro lado, en tanto las propiedades auto-reforzantes del IVA se pierden en la etapa del consumo final, exploro si sectores más involucrados en el consumo final –es decir, los que a priori podrían evadir más– responden de forma diferencial a la política. Agrupo los sectores de acuerdo al porcentaje de su producción con destino al consumo final en base a la matriz insumo-producto del BCU de 2016 y realizo dos estimaciones: una para los sectores por encima de la mediana del consumo final y una para los sectores por debajo.

Avances recientes en la literatura de diferencias en diferencias sugieren que la estrategia tradicional de estimación con efectos fijos bidireccionales puede presentar sesgos si los efectos de tratamiento son heterogéneos en el tiempo y entre cohortes de tratamiento [@callawayDifferenceinDifferencesMultipleTime2021; @dechaisemartinTwoWayFixedEffects2020]. Se han desarrollado tests para medir la gravedad del problema [@goodman-baconDifferenceindifferencesVariationTreatment2021] y métodos alternativos de estimación que eluden el problema [@dechaisemartinTwoWayFixedEffects2020; @sunEstimatingDynamicTreatment2021; @callawayDifferenceinDifferencesMultipleTime2021; @borusyakRevisitingEventStudy2022]. Como ejercicio de robustez, replico las estimaciones principales usando la metodología propuesta por@callawayDifferenceinDifferencesMultipleTime2021. Este método tiene la ventaja de permitir heterogeneidad arbitraria en el efecto de tratamiento respecto al tiempo desde el inicio del tratamiento y entre cohortes. Los resultados se presentan en el @sec-appendix-cs21.

Clusterizo los errores estándar a nivel de empresa, ya que es el nivel al cual se define el tratamiento. Realizo las estimaciones principales en `R` usando el paquete `fixest` [@bergeEfficientEstimationMaximum2018]. Para el ejercicio de robustez con la metodología de @callawayDifferenceinDifferencesMultipleTime2021 realizo las estimaciones con el paquete `did` [@callawayDidDifferenceDifferences2021], programado por los propios autores. Organizo el proceso de limpieza de datos, estimaciones y confección de tablas y figuras usando el programa `Snakemake` [@molderSustainableDataAnalysis2021], para asegurar la replicabilidad de los resultados y automatizar el proceso. El código del trabajo está disponible en [Github](https://github.com/chezlag/msc-tesis).
