# Estrategia empírica {#sec-method}

Analizo el impacto de la recepción de facturas electrónicas sobre distintos desempeños de las empresas desde un enfoque de diferencias en diferencias. En mi análisis principal estimo una especificación con efectos fijos bidireccionales de la forma:

$$
y_{it} = \alpha_{i} + \tau_{t} + \beta_{post}\ D_{it} + u_{it}
$${#eq-twfe}

donde $y_{it}$ es el resultado de la empresa $i$ en el año $t$, $\alpha_{i}$ y $\tau_{t}$ son efectos fijos de empresa y año, y $D_{it}$ es un indicador que toma valor uno si la empresa $i$ recibió una e-factura en el período $t$. El impacto total de la política viene dado por el coeficiente $\beta_{post}$, que representa el efecto promedio de recibir e-facturas experimentado por todas las empresas que en algún momento recibieron una.

Comparo la variación en los resultados de las empresas que reciben facturas electrónicas (tratadas) con la variación en los resultados de las empresas que aún no han recibido (controles). El supuesto de identificación central es que las empresas tratadas y el grupo de control habrían evolucionado en paralelo en ausencia de facturación electrónica.

Para aportar evidencia que apoye el supuesto de tendencias paralelas y analizar la dinámica del impacto de recibir una e-factura, estimo una especificación de estudio de eventos de la @eq-twfe:

$$
y_{it} = \alpha_{i} + \tau_{t}+ \sum_{l\neq -1, l = -7}^{l = 3} \beta_{l}\cdot \mathbb{1}(R_{it} = l) + u_{it}
$${#eq-es}

donde $R_{it}$ indica los años desde el momento en que las empresas reciben su primera e-factura. Los coeficientes $\beta_{l}$ capturan la diferencia de resultados entre empresas tratadas y controles a $l$ períodos de recibir el tratamiento.

Mis variables de resultado son IVA compras, IVA ventas y el IVA adeudado neto (= máx{IVA ventas - IVA compras, 0}). Para la forma funcional sigo las recomendaciones de @chenLogsZerosProblems2023 para lidiar con variables dependientes en logaritmos cuando hay un porcentaje no trivial de ceros en su distribución. [^chen-roth] Una de sus propuestas –la que sigo– implica reescalar la variable de resultado $Y_{it}$ respecto a su valor mínimo $Y_{min}$ y asignarle un valor específico $\varepsilon$ a los cambios en el margen extensivo. Formalmente, defino 

[^chen-roth]: La forma funcional de las variables dependientes no es trivial. @chenLogsZerosProblems2023 señalan los peligros de utilizar transformaciones cuasi-logarítmicas definidas en cero –como $\log(Y+1)$ o $\text{arcsinh}(Y)$– de variables dependientes no negativas. Interpretar los efectos de tratamiento estimados usando este tipo de transformaciones como efectos porcentuales es un error, en tanto dependen de la unidad de medida de $Y$. Si el tratamiento tiene un efecto en el margen extensivo, los autores muestran es posible obtener efectos de tratamiento de cualquier magnitud re-escalando $Y$ antes de aplicar la transformación cuasi-logarítimica.

$$
y_{it} =
\begin{cases}
  \log(\frac{Y_{it}}{Y_{min}}) & \text{si } Y_{it}>0 \\
  -\varepsilon                 & \text{si } Y_{it} = 0
\end{cases}
$$

En mi especificación preferida asumo que los cambios en el margen extensivo (de cero a $Y_{min}$) son equivalentes a un cambio de 10% en el margen intensivo –es decir, $\varepsilon=0.10$–. Como ejercicio de robustez, varío el valor asignado a $\varepsilon$ para ver que los resultados se mantienen independientemente de cuanto peso otorgo a los cambios en el margen extensivo. Por otra parte, aplico una censura superior (*winsorizing*) de los resultados en el percentil 99 de cada año. [^winsorizing]

[^winsorizing]: La censura superior de las variables de resultado elimina la influencia de outliers y de errores en el ingreso de los datos. Aún en ausencia de errores, censurar los datos puede ser óptimo al estimar medias en muestras finitas de distribuciones asimétricas [@rivestStatisticalPropertiesWinsorized1994]. Como ejercicio de robustez, replico las estimaciones censurando en el percentil 95 de cada año.

Testeo las hipótesis planteadas en la [Sección @sec-hypotheses] con los coeficientes $\beta_{post}$ de la @eq-twfe. Es decir, me centro en el efecto agregado de la política para testear si la recepción de e-facturas modificó el cumplimiento tributario de las empresas. 

Además, exploro la presencia de efectos heterogéneos de tres maneras diferentes. Primero, estudio si las firmas responden de manera divergente según su tamaño, dividiendo la muestra según el nivel de activos de las empresas antes de 2011. Segundo, analizo si los sectores muestran respuestas diferentes según su exposición al consumo final, segmentando la muestra según el porcentaje de producción de un sector destinado al consumo final de los hogares. Finalmente, examino si los sectores exhiben respuestas distintas en función de la proporción de sus insumos que proviene del exterior, dividiendo la muestra según el porcentaje del consumo intermedio de cada sector que es importado.[^sector-summary] Dado el tamaño limitado de la muestra, en los tres casos divido la muestra en dos grupos, según si las empresas están por encima o por debajo de la mediana de la variable de interés. Estimo regresiones de acuerdo a la siguiente especificación

$$
y_{it} = \alpha_{i} + \tau_{t} + \beta_{low}\cdot D_{it} \cdot BelowMedian_{i} + \beta_{high}\cdot D_{it} \cdot AboveMedian_{i} + u_{it}
$${#eq-twfe-het}

donde $BelowMedian_{i}$ y $AboveMedian_{i}$ indican si la empresa está por encima o por debajo de la mediana de cada una de las variables mencionadas. Comparo $\beta_{low}$ y $\beta_{high}$ para estudiar la existencia de efectos heterogéneos a lo largo de los grupos mencionados.

[^sector-summary]: Clasifico los sectores de acuerdo al porcentaje de su producción con destino al consumo final de los hogares y con destino exportador a partir la matriz insumo-producto del BCU de 2016. La @tbl-industry-summary resume la información de los sectores.

Avances recientes en la literatura de diferencias en diferencias sugieren que la estrategia tradicional de estimación con efectos fijos bidireccionales puede presentar sesgos si los efectos de tratamiento son heterogéneos en el tiempo y entre cohortes de tratamiento [@callawayDifferenceinDifferencesMultipleTime2021; @dechaisemartinTwoWayFixedEffects2020]. Se han desarrollado tests para medir la gravedad del problema [@goodman-baconDifferenceindifferencesVariationTreatment2021] y métodos alternativos de estimación que eluden el problema [@dechaisemartinTwoWayFixedEffects2020; @sunEstimatingDynamicTreatment2021; @callawayDifferenceinDifferencesMultipleTime2021; @borusyakRevisitingEventStudy2022]. Como ejercicio de robustez, replico las estimaciones principales usando la metodología propuesta por @callawayDifferenceinDifferencesMultipleTime2021. Este método tiene la ventaja de permitir heterogeneidad arbitraria en el efecto de tratamiento respecto al tiempo desde el inicio del tratamiento y entre cohortes. Los resultados se presentan en el @sec-appendix-cs21 y se discuten en la [sección @sec-results-effect-robust].

Clusterizo los errores estándar a nivel de empresa, ya que es el nivel al cual se define el tratamiento. Realizo las estimaciones principales en `R` usando el paquete `fixest` [@bergeEfficientEstimationMaximum2018]. Para el ejercicio de robustez con la metodología de @callawayDifferenceinDifferencesMultipleTime2021 realizo las estimaciones con el paquete `did` [@callawayDidDifferenceDifferences2021], programado por los propios autores. Organizo el proceso de limpieza de datos, estimaciones y confección de tablas y figuras usando el programa `Snakemake` [@molderSustainableDataAnalysis2021], para asegurar la replicabilidad de los resultados y automatizar el proceso. El código del trabajo está disponible en [Github](https://github.com/chezlag/msc-tesis).
